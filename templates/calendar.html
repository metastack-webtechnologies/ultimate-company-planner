{% extends 'base.html' %} {% load static %} {% block content %}
<h1 class="text-center text-3xl font-bold my-6">My Calendar</h1>

<div id="calendar"></div>

<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client"></script>

<script>
  const API_KEY = "AIzaSyDsB8Daijk43A3G00HDzEOFCD4tTD0hytM";
  const CLIENT_ID =
    "1031725591663-heb3b2grhlcrh5ahehs303tg7jtps55h.apps.googleusercontent.com";
  const DISCOVERY_DOC =
    "https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest";
  const SCOPES = "https://www.googleapis.com/auth/calendar.events.readonly";

  function handleClientLoad() {
    gapi.load("client:auth2", initClient);
  }

  function initClient() {
    gapi.client
      .init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: [DISCOVERY_DOC],
        scope: SCOPES,
      })
      .then(() => {
        if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
          gapi.auth2.getAuthInstance().signIn();
        } else {
          listUpcomingEvents();
        }
      });
  }

  function listUpcomingEvents() {
    gapi.client.calendar.events
      .list({
        calendarId: "primary",
        timeMin: new Date().toISOString(),
        showDeleted: false,
        singleEvents: true,
        maxResults: 10,
        orderBy: "startTime",
      })
      .then((response) => {
        const events = response.result.items;
        const calendarDiv = document.getElementById("calendar");
        calendarDiv.innerHTML =
          "<h3 class='text-xl font-semibold mb-4'>Upcoming Events:</h3>";
        if (events.length > 0) {
          const ul = document.createElement("ul");
          events.forEach((event) => {
            const li = document.createElement("li");
            const when = event.start.dateTime || event.start.date;
            li.textContent = `${event.summary} â€“ ${when}`;
            ul.appendChild(li);
          });
          calendarDiv.appendChild(ul);
        } else {
          calendarDiv.innerHTML += "<p>No upcoming events found.</p>";
        }
      });
  }

  handleClientLoad();
</script>
{% endblock %}
